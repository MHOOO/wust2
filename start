#!/bin/bash

export POSTGRES_DB=${POSTGRES_DB:-'wust'} \
       POSTGRES_USER=${POSTGRES_USER:-'test'} \
       POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-'test'}

cmd="$(dirname $0)/docker/compose"

case $1 in
dev)
    $cmd dev down
    $cmd dev build wust
    $cmd dev run wust
    ;;
local)
    $cmd local down
    $cmd local up --build -d
    POSTGRES_HOSTNAME=localhost sbt
    ;;
prod)
    sbt backend/assembly
    $cmd prod up --build
    ;;
*)
    echo "unknown stage '$1', expected one of [prod,local,dev]"
    exit 1
esac
